<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sweet Mary's Order Form</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --primary-color: #ff6f61; /* A vibrant, sweet red/orange */
            --secondary-color: #ffc107; /* A warm yellow/gold */
            --accent-color: #4caf50; /* A pleasant green for success/available */
            --text-dark: #333;
            --text-light: #666;
            --bg-light: #f9f9f9;
            --border-color: #ddd;
            --card-bg: #fff;
            --error-color: #f44336;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--bg-light);
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 20px auto;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        .logo-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-section img {
            max-width: 250px;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        h2 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 25px;
            font-size: 2.2em;
            letter-spacing: 1px;
        }

        .section-title {
            font-size: 1.8em;
            color: var(--secondary-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-top: 40px;
            margin-bottom: 25px;
            text-align: center;
        }

        /* --- Tabs for Menu / Order Here --- */
        .main-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .main-tabs button {
            background-color: #eee;
            border: 1px solid var(--border-color);
            padding: 12px 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s ease;
            color: var(--text-dark);
            flex-grow: 1;
            max-width: 200px;
        }

        .main-tabs button:hover {
            background-color: var(--secondary-color);
            color: var(--card-bg);
            border-color: var(--secondary-color);
        }

        .main-tabs button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .tab-content {
            display: none; /* Hidden by default */
        }

        .tab-content.active {
            display: block; /* Shown when active */
        }

        /* --- Menu Gallery --- */
        .menu-gallery {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
        }

        .menu-gallery img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            width: clamp(280px, 45vw, 450px); /* Responsive image size */
        }

        .menu-gallery img:hover {
            transform: translateY(-5px);
        }

        /* --- Category Tabs --- */
        .category-tabs {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            border-top: 1px solid var(--border-color);
        }

        .category-tabs button {
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            padding: 8px 18px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            border-radius: 20px;
            transition: all 0.2s ease;
            color: var(--text-dark);
        }

        .category-tabs button:hover {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .category-tabs button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* --- Product Catalog --- */
        .product-catalog {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .product-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
        }

        .product-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 1px solid var(--border-color);
        }

        .product-info {
            padding: 20px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .product-info h4 {
            font-size: 1.4em;
            margin-bottom: 10px;
            color: var(--primary-color);
            text-align: center;
        }

        .product-info strong {
            display: block;
            margin-top: 10px;
            font-size: 1.1em;
            color: var(--text-dark);
            /* Added for centering */
            text-align: center;
        }

        .product-info p {
            font-size: 1.2em;
            color: var(--accent-color);
            font-weight: 600;
            margin-bottom: 10px;
            /* Added for centering */
            text-align: center;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed var(--border-color);
        }

        .quantity-control button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            font-size: 1.5em;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1; /* Ensures text is centered vertically */
        }

        .quantity-control button:hover {
            background-color: var(--primary-color);
        }

        .quantity-control span {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--text-dark);
            min-width: 30px;
            text-align: center;
        }

        .product-status {
            text-align: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed var(--border-color);
        }

        .status-badge {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
            text-transform: uppercase;
        }

        .status-badge.out-of-stock {
            background-color: #ffebee;
            color: #d32f2f;
            border: 1px solid #d32f2f;
        }

        .status-badge.available {
            background-color: #e8f5e9;
            color: #388e3c;
            border: 1px solid #388e3c;
        }

        .status-badge.coming-soon {
            background-color: #fffde7;
            color: #fbc02d;
            border: 1px solid #fbc02d;
        }

        /* --- Cart Summary --- */
        .cart-summary {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            margin-bottom: 30px;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .cart-summary h3 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.6em;
        }

        #cartItemsList {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
            max-height: 250px; /* Limit height */
            overflow-y: auto; /* Enable scrolling */
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 15px;
        }

        #cartItemsList li {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dotted #eee;
            font-size: 0.95em;
        }

        #cartItemsList li:last-child {
            border-bottom: none;
        }

        .cart-subtotal-item,
        .delivery-fee-item {
            font-weight: 600;
            color: var(--text-dark);
            padding: 10px 0;
            border-top: 1px solid var(--border-color);
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            font-size: 1.1em;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.5em;
            font-weight: 700;
            color: var(--primary-color);
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid var(--secondary-color);
        }

        .proceed-checkout-button {
            display: block;
            width: fit-content; /* Adjust width to content */
            margin: 20px auto 0; /* Center the button */
            padding: 15px 30px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .proceed-checkout-button:hover {
            background-color: #388e3c; /* Darker green */
            transform: translateY(-2px);
        }

        /* --- Form Styling --- */
        form {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 1em;
        }

        .required-star {
            color: var(--primary-color);
            font-size: 1.1em;
            margin-left: 3px;
        }

        .form-group input[type='text'],
        .form-group input[type='email'],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1em;
            color: var(--text-dark);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .form-group input[type='text']:focus,
        .form-group input[type='email']:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 111, 97, 0.2);
            outline: none;
        }

        .form-group input.error,
        .form-group select.error,
        .date-picker-section.error,
        .time-picker-section.error {
            border-color: var(--error-color) !important;
            box-shadow: 0 0 0 3px rgba(244, 67, 54, 0.2) !important;
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: var(--text-light);
            font-size: 0.85em;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* --- Date & Time Picker --- */
        .date-time-picker-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background-color: var(--bg-light);
            display: none; /* Hidden by default, shown for delivery */
        }

        .date-picker-section,
        .time-picker-section {
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .date-input-group {
            position: relative;
            margin-bottom: 15px;
        }

        .date-input-group input {
            padding-right: 40px; /* Space for icon */
        }

        .calendar-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 1.2em;
        }

        .calendar-controls {
            background-color: #fcfcfc;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .calendar-header button {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--secondary-color);
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.2s ease;
        }

        .calendar-header button:hover {
            background-color: #f0f0f0;
        }

        .calendar-header h4 {
            margin: 0;
            font-size: 1.3em;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 10px;
            font-size: 0.85em;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            text-align: center;
        }

        .calendar-days div {
            padding: 10px 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
            font-size: 0.95em;
        }

        .calendar-days div:hover:not(.past-date):not(.other-month) {
            background-color: var(--secondary-color);
            color: white;
        }

        .calendar-days div.past-date {
            color: #ccc;
            cursor: not-allowed;
            background-color: #f5f5f5;
        }

        .calendar-days div.current-day {
            border: 2px solid var(--primary-color);
            font-weight: 700;
        }

        .calendar-days div.selected-date {
            background-color: var(--primary-color);
            color: white;
            font-weight: 700;
        }

        .time-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .time-header h4 {
            font-size: 1.3em;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .time-zone {
            font-size: 0.9em;
            color: var(--text-light);
        }

        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            max-height: 250px;
            overflow-y: auto;
            padding-right: 10px; /* for scrollbar */
        }

        .time-slot {
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            background-color: #fefefe;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            font-weight: 500;
            font-size: 0.95em;
        }

        .time-slot:hover:not(.unavailable) {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .time-slot.unavailable {
            background-color: #f5f5f5;
            color: #ccc;
            border-color: #eee;
            cursor: not-allowed;
            text-decoration: line-through;
        }

        .time-slot.selected-time {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-weight: 700;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        form button[type='button'] {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.3em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 30px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        form button[type='button']:hover {
            background-color: #e55c50; /* Darker red */
            transform: translateY(-2px);
        }

        /* SweetAlert Custom Button Styling */
        .swal-button {
            background-color: var(--primary-color) !important;
            color: white !important;
            border-radius: 5px !important;
            font-size: 1em !important;
            padding: 8px 20px !important;
            transition: background-color 0.2s ease;
        }

        .swal-button:hover {
            background-color: #e55c50 !important;
        }

        /* Payment Instructions in SweetAlert */
        .payment-instructions {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid;
            border-radius: 8px;
            text-align: left;
            font-size: 0.9em;
        }

        .payment-instructions h4 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .payment-instructions p {
            margin-bottom: 5px;
        }

        .payment-instructions img {
            max-width: 180px;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 5px;
        }

        /* Responsive Design */
        @media (min-width: 768px) {
            .container {
                grid-template-columns: 1fr; /* Single column layout for larger screens */
            }

            .date-time-picker-container {
                grid-template-columns: 1fr 1fr; /* Two columns for date and time */
            }
        }

        @media (max-width: 767px) {
            body {
                padding: 15px;
            }

            .container {
                padding: 20px;
            }

            h2 {
                font-size: 1.8em;
            }

            .section-title {
                font-size: 1.5em;
            }

            .product-catalog {
                grid-template-columns: 1fr; /* Single column on small screens */
            }

            .product-info h4 {
                font-size: 1.2em;
            }

            .quantity-control button {
                width: 30px;
                height: 30px;
                font-size: 1.3em;
            }

            .quantity-control span {
                font-size: 1.1em;
            }

            .time-slots {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }

            form button[type='button'] {
                font-size: 1.1em;
                padding: 12px;
            }
        }
        /* For the red asterisk */
        .required-star {
            color: red;
        }
        .form-group {
            margin-bottom: 15px; /* Spacing between form fields */
        }

        .form-group label {
            display: block; /* Make label take its own line */
            margin-bottom: 5px; /* Space between label and input */
            font-weight: bold; /* Make labels stand out */
            color: var(--text-dark); /* Assuming you have a CSS variable for dark text */
        }

        /* Styling for the dropdown itself */
        #shippingAddressSelect {
            width: 100%; /* Take full width of its container */
            padding: 10px 15px; /* Padding inside the dropdown */
            border: 1px solid #ccc; /* Default border color */
            border-radius: 5px; /* Slightly rounded corners */
            font-size: 1em; /* Readable font size */
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
            -webkit-appearance: none; /* Remove default browser dropdown arrow on WebKit browsers */
            -moz-appearance: none; /* Remove default browser dropdown arrow on Mozilla browsers */
            appearance: none; /* Remove default browser dropdown arrow */
            background-color: #fff; /* White background */
            background-image: url('data:image/svg+xml;utf8,<svg fill="#666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>'); /* Custom dropdown arrow */
            background-repeat: no-repeat;
            background-position: right 10px center; /* Position the arrow */
            cursor: pointer;
        }

        /* Red border for error/required state (matching your image) */
        /* This is typically added by JavaScript when a field is invalid */
        #shippingAddressSelect.error,
        #shippingAddressSelect:required:invalid, /* For initial load if required and no selection */
        #shippingAddressSelect:focus { /* Optional: Red border on focus as well, or a different color */
            border-color: #e74c3c; /* Red color */
            box-shadow: 0 0 0 1px #e74c3c; /* Optional: small red glow */
            outline: none; /* Remove default focus outline */
        }

        /* Style for the delivery fee display text */
        #selectedDeliveryFeeDisplay {
            margin-top: 8px; /* Space above the fee text */
            font-size: 0.9em; /* Slightly smaller font than input */
            color: var(--text-muted, #555); /* Lighter text color, use CSS variable if defined */
            font-weight: bold; /* Make it bold as in your image */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-section">
            <img src="https://i.postimg.cc/mZXr21dt/mary-logo.png" alt="Sweet Mary's Logo" />
        </div>
        <h2>PLACE YOUR ORDER</h2>

        <div class="main-tabs">
            <button class="tab-button active" onclick="showMainTab('menu')">MENU</button>
            <button class="tab-button" onclick="showMainTab('order')">ORDER HERE</button>
        </div>

        <div id="menuTabContent" class="tab-content active">
            <h3 class="section-title">Our Delicious Menu</h3>
            <div class="menu-gallery">
                <img src="https://i.ibb.co/cc1q6VMS/4.png" alt="Cookies Menu">
                <img src="https://i.ibb.co/ccXK7YcW/6.png" alt="Mini Menu">
                <img src="https://i.ibb.co/rGBLPCk0/3.png" alt="Chocolate Crinkles & Loafs Menu">
                <img src="https://i.ibb.co/rG88CqRk/5.png" alt="Muffin Menu">

            </div>
        </div>

        <div id="orderTabContent" class="tab-content">
            <h3 class="section-title">Select Your Items</h3>

            <div class="category-tabs" id="categoryTabs">
                </div>

            <div class="product-catalog" id="productCatalog">
                </div>

            <div class="cart-summary">
                <h3>Your Cart üõí</h3>
                <ul id="cartItemsList">
                    </ul>
                <div class="cart-total">
                    <span>Total:</span>
                    <span id="totalAmount">‚Ç±0.00</span>
                </div>
                <button type="button" class="proceed-checkout-button" onclick="proceedToCheckout()">Proceed to Checkout</button>
            </div>

            <form id="order-form">
                <h3 class="section-title">Your Details</h3>
                <div class="form-group">
                    <label for="fullName">Full Name <span class="required-star">*</span></label>
                    <input type="text" id="fullName" required />
                </div>
                <div class="form-group">
                    <label for="email">Email Address <span class="required-star">*</span></label>
                    <input
                        type="email"
                        id="email"
                        placeholder="example@gmail.com"
                        required
                    />
                </div>
                <div class="form-group">
                    <label for="address">Address <span class="required-star">*</span></label>
                    <input type="text" id="address" required />
                </div>
                <div class="form-group">
                    <label for="contactNumber">Contact Number <span class="required-star">*</span></label>
                    <input
                        type="text"
                        id="contactNumber"
                        maxlength="11"
                        placeholder="11-digits number"
                        required
                    />
                </div>

                <h3 class="section-title">Order Type</h3>
                <div class="form-group">
                    <label for="orderType">Choose how to get your order: <span class="required-star">*</span></label>
                    <select id="orderType" required onchange="toggleOrderType()">
                        <option value="">SELECT</option>
                        <option value="delivery">Delivery</option>
                        <option value="pickup">Pickup</option>
                        <option value="meetup">Meet Up</option>
                    </select>
                </div>

                <div id="deliveryDetails" class="form-group" style="display: none;">
                    <label for="shippingAddressSelect">Delivery Address <span class="required-star">*</span></label>
                    <select id="shippingAddressSelect" required onchange="handleDeliveryLocationChange()">
                        <option value="">Select a delivery location</option>
                        </select>
                    <div id="selectedDeliveryFeeDisplay" class="info-text"></div>
                </div>

                <div id="pickupDetails" class="form-group" style="display: none;">
                    <label for="pickupLocation">Pickup Location</label>
                    <input type="text" id="pickupLocation" value="1435 ARANVILLE SUBD BRGY SAN JOSE SAN PABLO CITY LAGUNA" readonly />
                    <small>Please pick up your order at our designated location.</small>
                </div>

                <h3 class="section-title" id="deliveryDateTimeHeader" style="margin-top: 40px; display: none;">Delivery Date & Time</h3>
                <div class="date-time-picker-container" style="display: none;">
                    <div class="date-picker-section">
                        <label for="deliveryDate">Delivery Date <span class="required-star">*</span></label>
                        <div class="date-input-group">
                            <input type="text" id="deliveryDate" placeholder="MM/DD/YYYY" readonly required />
                            <span class="calendar-icon" onclick="document.getElementById('deliveryDate').click()">üóìÔ∏è</span>
                        </div>
                        <div class="calendar-controls">
                            <div class="calendar-header">
                                <button type="button" onclick="changeMonth(-1)">&lt;</button>
                                <h4 id="monthYear"></h4>
                                <button type="button" onclick="changeMonth(1)">&gt;</button>
                            </div>
                            <div class="calendar-weekdays">
                                <div>SUN</div>
                                <div>MON</div>
                                <div>TUE</div>
                                <div>WED</div>
                                <div>THU</div>
                                <div>FRI</div>
                                <div>SAT</div>
                            </div>
                            <div class="calendar-days" id="calendarDays">
                            </div>
                        </div>
                    </div>

                    <div class="time-picker-section">
                        <label for="deliveryTime">Delivery Time <span class="required-star">*</span></label>
                        <div class="time-header">
                            <h4 id="selectedDateDisplay">Select a Delivery Date</h4>
                            <span class="time-zone" id="currentTimeZone"></span>
                        </div>
                        <div class="time-slots" id="timeSlots">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="paymentMethod">Payment Method <span class="required-star">*</span></label>
                    <select id="paymentMethod" required>
                        <option value="CASH">CASH</option>
                        <option value="GCASH">GCASH</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="remarks"><strong>Remarks</strong> (e.g., delivery instructions, special requests)</label>
                    <textarea
                        id="remarks"
                        placeholder="Any additional requests?"
                    ></textarea>
                </div>
                <button type="submit">Place Order</button>
            </form>
        </div>
    </div>

    <script>
        // Global Variables
        let products = []; // This will hold the main product data, merged with sheet data
        let cart = {};
        let deliveryFee = 0;
        let deliveryLocations = []; // To store locations fetched from the sheet
        let categories = {}; // Populated dynamically from fetched products


        // Date Picker Globals
        const months = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
        ];
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let selectedDeliveryDate = null;
        let selectedDeliveryTime = null;
        const timeSlots = [
            "9:00 AM", "9:30 AM", "10:00 AM", "10:30 AM", "11:00 AM", "11:30 AM",
            "1:00 PM", "1:30 PM", "2:00 PM", "2:30 PM", "3:00 PM", "3:30 PM",
            "4:00 PM", "4:30 PM", "5:00 PM", "5:30 PM", "6:00 PM", "6:30 PM",
            "7:00 PM", "7:30 PM"
        ];

        // Base product data (used as fallback if sheet fails)
        const baseProducts = [
            // CRINKLES
            { id: 'crinkles10pcs', name: 'CRINKLES (10pcs)', category: 'CRINKLES', price: 100, image: 'https://i.ibb.co/5g6vgY8L/image.png' },
            { id: 'chocoCrinkles10pcs', name: 'CHOCO FILLED (10pcs)', category: 'CRINKLES', price: 120, image: 'https://i.ibb.co/5g6vgY8L/image.png' },
            { id: 'chocoLavaCrinkles', name: 'CHOCO LAVA (4pcs)', category: 'CRINKLES', price: 150, image: 'https://i.ibb.co/LdHtkTkR/image.png' },
            { id: 'UbeCrinkles', name: 'UBE (10pcs)', category: 'CRINKLES', price: 130, image: 'https://i.ibb.co/JF80rk84/image.png' },
            { id: 'chocoCrinkles50g', name: 'CHOCO FILLED (50g)', category: 'CRINKLES', price: 60, image: 'https://i.ibb.co/60BWQZQj/image.png' },
            { id: 'redVelvetLava', name: 'RED VELVET LAVA', category: 'CRINKLES', price: 75, image: 'https://i.ibb.co/bRD8qVmG/image.png' },

            // COOKIES
            { id: 'chocolateChip50g', name: 'CHOCOLATE CHIP (50G)', category: 'COOKIES', price: 80, image: 'https://i.ibb.co/TxPktrs6/image.png' },
            { id: 'chocolateChip100g', name: 'CHOCOLATE CHIP (100G)', category: 'COOKIES', price: 150, image: 'https://i.ibb.co/TxPktrs6/image.png' },
            { id: 'chocoWalnut50g', name: 'CHOCO WALNUT (50G)', category: 'COOKIES', price: 85, image: 'https://i.ibb.co/sd1cLbLT/image.png' },
            { id: 'chocoWalnut100g', name: 'CHOCO WALNUT (100G)', category: 'COOKIES', price: 160, image: 'https://i.ibb.co/sd1cLbLT/image.png' },
            { id: 'nutellaChocoAlmond50g', name: 'NUTELLA CHOCO ALMOND (50G)', category: 'COOKIES', price: 90, image: 'https://i.ibb.co/RGsxDq2s/image.png' },
            { id: 'nutellaChocoAlmond100g', name: 'NUTELLA CHOCO ALMOND (100G)', category: 'COOKIES', price: 170, image: 'https://i.ibb.co/RGsxDq2s/image.png' },
            { id: 'smores50g', name: 'S\'MORES (50G)', category: 'COOKIES', price: 95, image: 'https://i.ibb.co/Y7n4CJtp/image.png' },
            { id: 'smores100g', name: 'S\'MORES (100G)', category: 'COOKIES', price: 180, image: 'https://i.ibb.co/Y7n4CJtp/image.png' },
            { id: 'chocoBiscoff50g', name: 'CHOCO BISCOFF (50G)', category: 'COOKIES', price: 90, image: 'https://i.ibb.co/DHNKjJsp/image.png' },
            { id: 'chocoBiscoff100g', name: 'CHOCO BISCOFF (100G)', category: 'COOKIES', price: 170, image: 'https://i.ibb.co/DHNKjJsp/image.png' },
            { id: 'whiteChocoBiscoff50g', name: 'WHITE CHOCO BISCOFF (50G)', category: 'COOKIES', price: 90, image: 'https://i.ibb.co/nq6cRqv7/image.png' },
            { id: 'whiteChocoBiscoff100g', name: 'WHITE CHOCO BISCOFF (100G)', category: 'COOKIES', price: 170, image: 'https://i.ibb.co/nq6cRqv7/image.png' },
            { id: 'matchaCream50g', name: 'MATCHA CREAM (50G)', category: 'COOKIES', price: 85, image: 'https://i.ibb.co/5hzyxkNL/image.png' },
            { id: 'matchaCream100g', name: 'MATCHA CREAM (100G)', category: 'COOKIES', price: 160, image: 'https://i.ibb.co/5hzyxkNL/image.png' },
            { id: 'redVelvetCream50g', name: 'RED VELVET CREAM (50G)', category: 'COOKIES', price: 85, image: 'https://i.ibb.co/j9JstxX0/image.png' },
            { id: 'redVelvetCream100g', name: 'RED VELVET CREAM (100G)', category: 'COOKIES', price: 160, image: 'https://i.ibb.co/j9JstxX0/image.png' },
            { id: 'assorted6pcs50g', name: 'ASSORTED (6pcs - 50G)', category: 'COOKIES', price: 500, image: 'https://i.ibb.co/vCFVWsLs/image.png' },
            { id: 'assorted6pcs100g', name: 'ASSORTED (6pcs - 100G)', category: 'COOKIES', price: 950, image: 'https://i.ibb.co/vCFVWsLs/image.png' },

            // MINI COOKIES
            { id: 'miniDarkCookies6pcs', name: 'DARK (6PCS)', category: 'MINI COOKIES', price: 150, image: 'https://i.ibb.co/j1VXkqs/image.png' },
            { id: 'miniDarkCookies12pcs', name: 'DARK (12PCS)', category: 'MINI COOKIES', price: 300, image: 'https://i.ibb.co/j1VXkqs/image.png' },
            { id: 'miniChocoWalnutCookies6pcs', name: 'CHOCO WALNUT (6PCS)', category: 'MINI COOKIES', price: 150, image: 'https://i.ibb.co/wh6b8hFP/image.png' },
            { id: 'miniChocoWalnutCookies12pcs', name: 'CHOCO WALNUT (12PCS)', category: 'MINI COOKIES', price: 300, image: 'https://i.ibb.co/wh6b8hFP/image.png' },
            { id: 'miniSmoresCookies6pcs', name: 'S\'MORES (6PCS)', category: 'MINI COOKIES', price: 160, image: 'https://i.ibb.co/QzfTyRr/image.png' },
            { id: 'miniSmoresCookies12pcs', name: 'S\'MORES (12PCS)', category: 'MINI COOKIES', price: 320, image: 'https://i.ibb.co/QzfTyRr/image.png' },
            { id: 'miniWhiteChocoCookies6pcs', name: 'WHITE CHOCO (6PCS)', category: 'MINI COOKIES', price: 150, image: 'https://i.ibb.co/Gf4yNbYM/image.png' },
            { id: 'miniWhiteChocoCookies12pcs', name: 'WHITE CHOCO (12PCS)', category: 'MINI COOKIES', price: 300, image: 'https://i.ibb.co/Gf4yNbYM/image.png' },
            { id: 'miniRedVelvetCookies6pcs', name: 'RED VELVET (6PCS)', category: 'MINI COOKIES', price: 150, image: 'https://i.ibb.co/j9kL8884/image.png' },
            { id: 'miniRedVelvetCookies12pcs', name: 'RED VELVET (12PCS)', category: 'MINI COOKIES', price: 300, image: 'https://i.ibb.co/j9kL8884/image.png' },
            { id: 'miniMatchaCookies6pcs', name: 'MATCHA (6PCS)', category: 'MINI COOKIES', price: 150, image: 'https://i.ibb.co/mF9y0dpX/image.png' },
            { id: 'miniMatchaCookies12pcs', name: 'MATCHA (12PCS)', category: 'MINI COOKIES', price: 300, image: 'https://i.ibb.co/mF9y0dpX/image.png' },

            // MUFFIN
            { id: 'doubleChocolateMuffin4pcs', name: 'DOUBLE CHOCOLATE MUFFIN (4PCS)', category: 'MUFFIN', price: 200, image: 'https://i.ibb.co/fVD4LTYN/image.png' },
            { id: 'muffinBlueberry4pcs', name: 'BLUEBERRY MUFFIN (4PCS)', category: 'MUFFIN', price: 220, image: 'https://i.ibb.co/RGngGh64/image.png' },

            // BANANA CAKE
            { id: 'chocoBananaLoaf', name: 'CHOCO BANANA LOAF', category: 'BANANA CAKE', price: 250, image: 'https://i.ibb.co/bM1LcPHk/image.png' },
            { id: 'chocoBananaWalnut', name: 'CHOCO BANANA WALNUT', category: 'BANANA CAKE', price: 280, image: 'https://i.ibb.co/d0wjLq4j/image.png' },
            { id: 'chocoBananaCheesecakeBiscoff', name: 'CHOCO BANANA CHEESECAKE', category: 'BANANA CAKE', price: 300, image: 'https://i.ibb.co/M5yytrPJ/image.png' },
            { id: 'chocoBananaBiscoff', name: 'CHOCO BANANA BISCOFF', category: 'BANANA CAKE', price: 270, image: 'https://i.ibb.co/d4fHsGd4/image.png' },

            // BENTO CHEESE CAKE
            { id: 'bentoClassic', name: 'CLASSIC', category: 'BENTO CHEESE CAKE', price: 350, image: 'https://i.ibb.co/tThcZPnP/image.png' },
            { id: 'bentoBiscoff', name: 'BISCOFF', category: 'BENTO CHEESE CAKE', price: 380, image: 'https://i.ibb.co/207x87fM/image.png' },
            { id: 'bentoOreo', name: 'OREO', category: 'BENTO CHEESE CAKE', price: 370, image: 'https://i.ibb.co/LzWsW3dB/image.png' },
            { id: 'bentoNutella', name: 'NUTELLA', category: 'BENTO CHEESE CAKE', price: 390, image: 'https://i.ibb.co/m5L3DwmG/image.png' }
        ];

        // --- IMPORTANT: Replace with your actual deployed Apps Script Web App URL ---
        const WEB_APP_URL = 'YOUR_DEPLOYED_APPS_SCRIPT_WEB_APP_URL_HERE'; // <<< GET THIS FROM APPS SCRIPT DEPLOYMENT

        // --- DOM Elements (Get references once the DOM is loaded) ---
        let menuContainer; // The div where product cards will be rendered
        let categoryTabsContainer; // The div where category buttons will be added
        let cartItemsContainer; // The container for items in the cart
        let subTotalDisplay;
        let deliveryFeeDisplay;
        let totalAmountDisplay;
        let shippingAddressSelect; // The dropdown for delivery locations
        let deliveryDetailsSection; // Section that shows delivery date/time inputs
        let pickupDetailsSection; // Section that shows pickup location input
        let deliveryDateTimeHeader; // Header for delivery date & time section
        let dateTimePickerContainer; // Container for date and time pickers
        let selectedDeliveryFeeDisplay; // Element to show selected delivery fee


        // --- Initialization on DOM Ready ---
        document.addEventListener('DOMContentLoaded', () => {
            // Get DOM element references
            menuContainer = document.getElementById('productCatalog');
            categoryTabsContainer = document.getElementById('categoryTabs');
            cartItemsContainer = document.getElementById('cartItemsList');
            subTotalDisplay = document.getElementById('subTotalAmount'); // This ID doesn't exist in your HTML, consider adding it
            deliveryFeeDisplay = document.getElementById('deliveryFee'); // This ID doesn't exist, consider adding it
            totalAmountDisplay = document.getElementById('totalAmount');
            shippingAddressSelect = document.getElementById('shippingAddressSelect');
            deliveryDetailsSection = document.getElementById('deliveryDetails');
            pickupDetailsSection = document.getElementById('pickupDetails');
            deliveryDateTimeHeader = document.getElementById('deliveryDateTimeHeader');
            dateTimePickerContainer = document.querySelector('.date-time-picker-container');
            selectedDeliveryFeeDisplay = document.getElementById('selectedDeliveryFeeDisplay');


            // Initial data load
            loadProducts();
            loadDeliveryLocations();

            // Event listener for order type change
            const orderTypeSelect = document.getElementById('orderType');
            if (orderTypeSelect) {
                orderTypeSelect.addEventListener('change', toggleOrderType);
            }

            // Event listener for delivery address change (to update fee)
            if (shippingAddressSelect) {
                shippingAddressSelect.addEventListener('change', handleDeliveryLocationChange);
            }

            // Date picker event listeners
            document.getElementById('deliveryDate').addEventListener('click', () => showCalendar(currentMonth, currentYear));
            document.getElementById('deliveryDate').addEventListener('focus', (event) => { event.target.blur(); }); // Prevent soft keyboard

            // Event listeners for basic HTML5 date/time inputs
            const deliveryDateInput = document.getElementById('deliveryDate');
            const deliveryTimeInput = document.getElementById('deliveryTime');

            if (deliveryDateInput) {
                deliveryDateInput.addEventListener('change', (event) => {
                    selectedDeliveryDate = new Date(event.target.value);
                    renderTimeSlots(); // Re-render time slots when date changes
                });
            }
            if (deliveryTimeInput) {
                // This input is hidden; time is selected via custom time slots
                // The actual `selectedDeliveryTime` is set in selectTimeSlot()
            }

            // Initialize calendar
            renderCalendar();
            document.getElementById('currentTimeZone').textContent = Intl.DateTimeFormat().resolvedOptions().timeZone;


            // Initial call to hide/show delivery/pickup based on default selection
            toggleOrderType();
        });


        // --- Main Tab Switching ---
        function showMainTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            document.getElementById(tabId + 'TabContent').classList.add('active');
            document.querySelector(`.tab-button[onclick="showMainTab('${tabId}')"]`).classList.add('active');
        }


        // --- Product Loading & Rendering ---

        /**
         * Fetches products from Google Sheet and merges them with baseProducts.
         * Renders the product catalog and category tabs.
         */
        async function loadProducts() {
            try {
                // Show loading indicator
                menuContainer.innerHTML = '<p style="text-align: center;">Loading products...</p>';

                // Fetch data from Google Sheet
                const response = await fetch(`${WEB_APP_URL}?action=getProducts`);
                const sheetProducts = await response.json();

                // Merge sheet data with baseProducts
                // Prioritize sheet data for price, status, etc.
                products = baseProducts.map(baseProduct => {
                    const sheetProduct = sheetProducts.find(sp => sp.id === baseProduct.id);
                    return { ...baseProduct, ...sheetProduct }; // Merge: sheetProduct overrides baseProduct if IDs match
                });

                // Filter out products that might not have an ID or name
                products = products.filter(p => p.id && p.name);

                // Populate categories for tabs
                categories = products.reduce((acc, product) => {
                    if (product.category && !acc[product.category]) {
                        acc[product.category] = true;
                    }
                    return acc;
                }, {});

                renderCategoryTabs();
                renderProducts('ALL'); // Render all products initially
            } catch (error) {
                console.error('Error loading products:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'Failed to load products. Please try again later. Using fallback data.',
                });
                // Fallback to only baseProducts if sheet loading fails
                products = [...baseProducts];
                categories = products.reduce((acc, product) => {
                    if (product.category && !acc[product.category]) {
                        acc[product.category] = true;
                    }
                    return acc;
                }, {});
                renderCategoryTabs();
                renderProducts('ALL');
            }
        }

        /**
         * Renders a given array of products into the menu container.
         * @param {string} filterCategory The category to filter by, or 'ALL'.
         */
        function renderProducts(filterCategory) {
            if (!menuContainer) {
                console.error("Error: Product catalog container element not found for rendering!");
                return;
            }
            menuContainer.innerHTML = ''; // Clear existing items

            const productsToDisplay = filterCategory === 'ALL'
                ? products
                : products.filter(p => p.category === filterCategory);

            if (productsToDisplay.length === 0) {
                menuContainer.innerHTML = '<p class="text-center text-light">No items found in this category.</p>';
                return;
            }

            productsToDisplay.forEach(product => {
                const productCard = document.createElement('div');
                productCard.classList.add('product-card');

                // Determine availability status
                const isAvailable = product.status && product.status.toUpperCase() === 'AVAILABLE';
                const statusText = product.status ? product.status.toUpperCase() : 'N/A'; // Default to N/A if status missing
                let statusClass = '';
                if (statusText === 'AVAILABLE') {
                    statusClass = 'available';
                } else if (statusText === 'OUT OF STOCK') {
                    statusClass = 'out-of-stock';
                } else if (statusText === 'COMING SOON') {
                    statusClass = 'coming-soon';
                }

                productCard.innerHTML = `
                    <img src="${product.image || 'https://via.placeholder.com/200?text=No+Image'}" alt="${product.name}" class="product-img">
                    <div class="product-info">
                        <h4>${product.name}</h4>
                        <p>‚Ç±${product.price ? product.price.toFixed(2) : 'N/A'}</p>
                        <div class="product-status">
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                        <div class="quantity-control mt-auto">
                            <button type="button" onclick="decreaseQuantity('${product.id}')" ${!isAvailable ? 'disabled' : ''}>-</button>
                            <span id="quantity-${product.id}">${cart[product.id] || 0}</span>
                            <button type="button" onclick="increaseQuantity('${product.id}')" ${!isAvailable ? 'disabled' : ''}>+</button>
                        </div>
                    </div>
                `;
                menuContainer.appendChild(productCard);
            });
        }

        /**
         * Renders the category filter tabs based on available product categories.
         */
        function renderCategoryTabs() {
            if (!categoryTabsContainer) {
                console.error("Error: Category tabs container element not found!");
                return;
            }
            categoryTabsContainer.innerHTML = ''; // Clear previous tabs

            // Add 'ALL' category tab
            const allButton = document.createElement('button');
            allButton.textContent = 'ALL';
            allButton.classList.add('active'); // 'ALL' is active by default
            allButton.onclick = () => {
                renderProducts('ALL');
                setActiveCategoryTab(allButton);
            };
            categoryTabsContainer.appendChild(allButton);

            // Add other category tabs
            Object.keys(categories).forEach(category => {
                const button = document.createElement('button');
                button.textContent = category;
                button.onclick = () => {
                    renderProducts(category);
                    setActiveCategoryTab(button);
                };
                categoryTabsContainer.appendChild(button);
            });
        }

        /**
         * Sets the active class for category tabs.
         * @param {HTMLElement} activeButton The button element to set as active.
         */
        function setActiveCategoryTab(activeButton) {
            document.querySelectorAll('.category-tabs button').forEach(button => {
                button.classList.remove('active');
            });
            activeButton.classList.add('active');
        }


        // --- Cart Management ---

        /**
         * Increases the quantity of a product in the cart.
         * @param {string} productId The ID of the product.
         */
        function increaseQuantity(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || (product.status && product.status.toUpperCase() !== 'AVAILABLE')) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Unavailable',
                    text: `${product.name} is currently ${product.status ? product.status.toLowerCase() : 'unavailable'}.`,
                    customClass: {
                        confirmButton: 'swal-button'
                    }
                });
                return;
            }

            cart[productId] = (cart[productId] || 0) + 1;
            updateCartDisplay();
        }

        /**
         * Decreases the quantity of a product in the cart.
         * @param {string} productId The ID of the product.
         */
        function decreaseQuantity(productId) {
            if (cart[productId] > 0) {
                cart[productId]--;
                if (cart[productId] === 0) {
                    delete cart[productId]; // Remove item if quantity is 0
                }
                updateCartDisplay();
            }
        }

        /**
         * Updates the display of quantities on product cards and in the cart summary.
         */
        function updateCartDisplay() {
            // Update quantity on product cards
            for (const id in cart) {
                const quantitySpan = document.getElementById(`quantity-${id}`);
                if (quantitySpan) {
                    quantitySpan.textContent = cart[id];
                }
            }
            // If an item is removed from cart (quantity becomes 0), ensure its display is 0
            products.forEach(product => {
                if (!(product.id in cart)) {
                    const quantitySpan = document.getElementById(`quantity-${product.id}`);
                    if (quantitySpan) {
                        quantitySpan.textContent = 0;
                    }
                }
            });

            // Update cart summary list
            if (!cartItemsContainer) {
                console.error("Error: Cart items container element not found for display!");
                return;
            }
            cartItemsContainer.innerHTML = ''; // Clear previous items
            let subTotal = 0;

            for (const productId in cart) {
                const quantity = cart[productId];
                const product = products.find(p => p.id === productId);

                if (product && quantity > 0) {
                    const itemTotal = product.price * quantity;
                    subTotal += itemTotal;

                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <span>${product.name} x ${quantity}</span>
                        <span>‚Ç±${itemTotal.toFixed(2)}</span>
                    `;
                    cartItemsContainer.appendChild(listItem);
                }
            }

            // Add subtotal and delivery fee (if applicable)
            if (Object.keys(cart).length > 0) {
                const subtotalItem = document.createElement('li');
                subtotalItem.classList.add('cart-subtotal-item');
                subtotalItem.innerHTML = `<span>Subtotal:</span><span>‚Ç±${subTotal.toFixed(2)}</span>`;
                cartItemsContainer.appendChild(subtotalItem);

                if (document.getElementById('orderType').value === 'delivery') {
                    const deliveryFeeItem = document.createElement('li');
                    deliveryFeeItem.classList.add('delivery-fee-item');
                    deliveryFeeItem.innerHTML = `<span>Delivery Fee:</span><span id="deliveryFee">‚Ç±${deliveryFee.toFixed(2)}</span>`;
                    cartItemsContainer.appendChild(deliveryFeeItem);
                }
            } else {
                cartItemsContainer.innerHTML = '<li>Your cart is empty.</li>';
            }

            // Update total amount
            const totalAmount = subTotal + deliveryFee;
            if (totalAmountDisplay) {
                totalAmountDisplay.textContent = `‚Ç±${totalAmount.toFixed(2)}`;
            }
        }

        /**
         * Clears the cart and updates the display.
         */
        function clearCart() {
            cart = {};
            updateCartDisplay();
        }

        /**
         * Handles the click on "Proceed to Checkout" button.
         * Scrolls to the form and focuses the first input.
         */
        function proceedToCheckout() {
            if (Object.keys(cart).length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Cart Empty',
                    text: 'Please add items to your cart before proceeding to checkout.',
                    customClass: {
                        confirmButton: 'swal-button'
                    }
                });
                return;
            }

            // Switch to 'order' tab if not already there
            showMainTab('order');

            // Scroll to the order form
            const orderForm = document.getElementById('order-form');
            if (orderForm) {
                orderForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
                // Optionally focus on the first input field
                const firstInput = orderForm.querySelector('input, select, textarea');
                if (firstInput) {
                    firstInput.focus();
                }
            }
        }


        // --- Order Type, Delivery, and Pickup Logic ---

        /**
         * Toggles the visibility of delivery/pickup sections based on order type.
         */
        function toggleOrderType() {
            const orderType = document.getElementById('orderType').value;

            if (deliveryDetailsSection && pickupDetailsSection && deliveryDateTimeHeader && dateTimePickerContainer) {
                deliveryDetailsSection.style.display = 'none';
                pickupDetailsSection.style.display = 'none';
                deliveryDateTimeHeader.style.display = 'none';
                dateTimePickerContainer.style.display = 'none';
            }

            if (orderType === 'delivery' || orderType === 'meetup') {
                if (deliveryDetailsSection && deliveryDateTimeHeader && dateTimePickerContainer) {
                    deliveryDetailsSection.style.display = 'block';
                    deliveryDateTimeHeader.style.display = 'block';
                    dateTimePickerContainer.style.display = 'grid'; // Use grid for layout
                    // Reset delivery fee if order type changes from pickup
                    if (deliveryFee === 0) { // Only if it was previously 0 (e.g., from pickup)
                        handleDeliveryLocationChange(); // Recalculate fee for 'delivery'
                    }
                }
            } else if (orderType === 'pickup') {
                if (pickupDetailsSection) {
                    pickupDetailsSection.style.display = 'block';
                    deliveryFee = 0; // No delivery fee for pickup
                    updateCartDisplay();
                }
            } else {
                deliveryFee = 0; // Reset delivery fee if no type selected
                updateCartDisplay();
            }

            // Clear validation errors on address/date/time when changing order type
            clearValidationError(shippingAddressSelect);
            clearValidationError(document.querySelector('.date-picker-section'));
            clearValidationError(document.querySelector('.time-picker-section'));
        }

        /**
         * Loads delivery locations from the Google Sheet.
         */
        async function loadDeliveryLocations() {
            try {
                const response = await fetch(`${WEB_APP_URL}?action=getDeliveryLocations`);
                deliveryLocations = await response.json();
                renderDeliveryLocations();
            } catch (error) {
                console.error('Error loading delivery locations:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load delivery locations. Please try refreshing the page.',
                    customClass: {
                        confirmButton: 'swal-button'
                    }
                });
            }
        }

        /**
         * Renders delivery locations into the dropdown.
         */
        function renderDeliveryLocations() {
            if (!shippingAddressSelect) return;

            // Keep the "Select a delivery location" option
            const defaultOption = shippingAddressSelect.querySelector('option[value=""]');
            shippingAddressSelect.innerHTML = ''; // Clear existing options, then add default back
            if (defaultOption) {
                shippingAddressSelect.appendChild(defaultOption);
            } else {
                const newDefaultOption = document.createElement('option');
                newDefaultOption.value = '';
                newDefaultOption.textContent = 'Select a delivery location';
                shippingAddressSelect.appendChild(newDefaultOption);
            }

            deliveryLocations.forEach(location => {
                const option = document.createElement('option');
                option.value = location.location;
                option.textContent = `${location.location} (‚Ç±${location.fee.toFixed(2)})`;
                shippingAddressSelect.appendChild(option);
            });

            // Trigger update in case an option was pre-selected or to show default fee
            handleDeliveryLocationChange();
        }

        /**
         * Handles the change event for the delivery location dropdown.
         * Updates the delivery fee display and global deliveryFee variable.
         */
        function handleDeliveryLocationChange() {
            const selectedLocationName = shippingAddressSelect.value;
            const selectedLocation = deliveryLocations.find(loc => loc.location === selectedLocationName);

            if (selectedLocation) {
                deliveryFee = selectedLocation.fee;
                selectedDeliveryFeeDisplay.textContent = `Delivery Fee: ‚Ç±${deliveryFee.toFixed(2)}`;
                clearValidationError(shippingAddressSelect);
            } else {
                deliveryFee = 0; // No location selected or invalid
                selectedDeliveryFeeDisplay.textContent = '';
            }
            updateCartDisplay(); // Recalculate total with new delivery fee
        }


        // --- Date Picker Logic ---

        /**
         * Renders the calendar for the current month and year.
         */
        function renderCalendar() {
            const today = new Date();
            const firstDayOfMonth = new Date(currentYear, currentMonth, 1);
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const startDay = firstDayOfMonth.getDay(); // Day of the week (0 for Sunday)

            const monthYearDisplay = document.getElementById('monthYear');
            const calendarDaysContainer = document.getElementById('calendarDays');

            if (!monthYearDisplay || !calendarDaysContainer) {
                console.error("Calendar elements not found!");
                return;
            }

            monthYearDisplay.textContent = `${months[currentMonth]} ${currentYear}`;
            calendarDaysContainer.innerHTML = ''; // Clear previous days

            // Add empty divs for leading blank days
            for (let i = 0; i < startDay; i++) {
                const blankDay = document.createElement('div');
                blankDay.classList.add('other-month'); // Indicate it's not part of the current month
                calendarDaysContainer.appendChild(blankDay);
            }

            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.textContent = day;
                const currentDate = new Date(currentYear, currentMonth, day);

                // Disable past dates
                if (currentDate < today.setHours(0, 0, 0, 0)) { // Compare dates only, ignore time
                    dayDiv.classList.add('past-date');
                    dayDiv.style.cursor = 'not-allowed';
                } else {
                    dayDiv.addEventListener('click', () => selectDate(day));
                }

                // Highlight current day
                if (currentDate.toDateString() === today.toDateString()) {
                    dayDiv.classList.add('current-day');
                }

                // Highlight selected date
                if (selectedDeliveryDate && currentDate.toDateString() === selectedDeliveryDate.toDateString()) {
                    dayDiv.classList.add('selected-date');
                }

                calendarDaysContainer.appendChild(dayDiv);
            }
        }

        /**
         * Changes the month displayed in the calendar.
         * @param {number} offset -1 for previous month, 1 for next month.
         */
        function changeMonth(offset) {
            currentMonth += offset;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        }

        /**
         * Selects a date from the calendar.
         * @param {number} day The day of the month to select.
         */
        function selectDate(day) {
            selectedDeliveryDate = new Date(currentYear, currentMonth, day);
            document.getElementById('deliveryDate').value = selectedDeliveryDate.toLocaleDateString('en-US');
            document.getElementById('selectedDateDisplay').textContent = `Time for ${selectedDeliveryDate.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' })}`;
            renderCalendar(); // Re-render to show selected date highlight
            renderTimeSlots(); // Re-render time slots based on new date
            clearValidationError(document.querySelector('.date-picker-section'));
        }

        /**
         * Renders available time slots.
         */
        function renderTimeSlots() {
            const timeSlotsContainer = document.getElementById('timeSlots');
            if (!timeSlotsContainer) {
                console.error("Time slots container not found!");
                return;
            }
            timeSlotsContainer.innerHTML = ''; // Clear previous slots

            if (!selectedDeliveryDate) {
                timeSlotsContainer.innerHTML = '<p class="text-center text-light">Please select a delivery date first.</p>';
                return;
            }

            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()); // Today at 00:00:00

            timeSlots.forEach(slot => {
                const slotDiv = document.createElement('div');
                slotDiv.classList.add('time-slot');
                slotDiv.textContent = slot;

                const [time, period] = slot.split(' ');
                let [hours, minutes] = time.split(':').map(Number);

                if (period === 'PM' && hours !== 12) {
                    hours += 12;
                }
                if (period === 'AM' && hours === 12) { // Midnight (12 AM)
                    hours = 0;
                }

                const slotDateTime = new Date(selectedDeliveryDate.getFullYear(),
                                            selectedDeliveryDate.getMonth(),
                                            selectedDeliveryDate.getDate(),
                                            hours, minutes, 0);

                // Disable past time slots for the selected date if it's today
                if (selectedDeliveryDate.toDateString() === today.toDateString() && slotDateTime < now) {
                    slotDiv.classList.add('unavailable');
                    slotDiv.title = 'Past time slot';
                } else {
                    slotDiv.addEventListener('click', () => selectTimeSlot(slot));
                }

                // Highlight selected time slot
                if (selectedDeliveryTime === slot) {
                    slotDiv.classList.add('selected-time');
                }

                timeSlotsContainer.appendChild(slotDiv);
            });
        }

        /**
         * Selects a time slot.
         * @param {string} time The selected time string (e.g., "9:00 AM").
         */
        function selectTimeSlot(time) {
            selectedDeliveryTime = time;
            renderTimeSlots(); // Re-render to show selected time highlight
            clearValidationError(document.querySelector('.time-picker-section'));
        }


        // --- Form Submission & Validation ---

        /**
         * Validates the form inputs before submission.
         * @returns {boolean} True if the form is valid, false otherwise.
         */
        function validateForm() {
            let isValid = true;

            const fullName = document.getElementById('fullName');
            const email = document.getElementById('email');
            const address = document.getElementById('address');
            const contactNumber = document.getElementById('contactNumber');
            const orderType = document.getElementById('orderType');
            const paymentMethod = document.getElementById('paymentMethod');

            // Reset previous errors
            clearAllValidationErrors();

            // Validate Full Name
            if (!fullName.value.trim()) {
                markAsInvalid(fullName, 'Full Name is required.');
                isValid = false;
            }

            // Validate Email
            if (!email.value.trim()) {
                markAsInvalid(email, 'Email Address is required.');
                isValid = false;
            } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value)) {
                markAsInvalid(email, 'Please enter a valid email address.');
                isValid = false;
            }

            // Validate Address
            if (!address.value.trim()) {
                markAsInvalid(address, 'Address is required.');
                isValid = false;
            }

            // Validate Contact Number
            if (!contactNumber.value.trim()) {
                markAsInvalid(contactNumber, 'Contact Number is required.');
                isValid = false;
            } else if (!/^\d{11}$/.test(contactNumber.value)) {
                markAsInvalid(contactNumber, 'Contact Number must be 11 digits.');
                isValid = false;
            }

            // Validate Order Type
            if (!orderType.value) {
                markAsInvalid(orderType, 'Please select an Order Type.');
                isValid = false;
            }

            // Specific validation for Delivery/Meet Up
            if (orderType.value === 'delivery' || orderType.value === 'meetup') {
                if (!shippingAddressSelect.value) {
                    markAsInvalid(shippingAddressSelect, 'Please select a Delivery Location.');
                    isValid = false;
                }
                if (!selectedDeliveryDate) {
                    markAsInvalid(document.querySelector('.date-picker-section'), 'Please select a Delivery Date.');
                    isValid = false;
                }
                if (!selectedDeliveryTime) {
                    markAsInvalid(document.querySelector('.time-picker-section'), 'Please select a Delivery Time.');
                    isValid = false;
                }
            }

            // Validate Cart
            if (Object.keys(cart).length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Cart Empty',
                    text: 'Please add items to your cart before placing an order.',
                    customClass: {
                        confirmButton: 'swal-button'
                    }
                });
                isValid = false;
            }

            // Validate Payment Method
            if (!paymentMethod.value) {
                markAsInvalid(paymentMethod, 'Please select a Payment Method.');
                isValid = false;
            }

            return isValid;
        }

        /**
         * Marks an input element as invalid and displays an error message.
         * @param {HTMLElement} element The input element to mark.
         * @param {string} message The error message to display.
         */
function markAsInvalid(element, message) {
    element.classList.add('error');
    let errorSpan = element.nextElementSibling; // Check for existing error span
    if (errorSpan && errorSpan.classList.contains('error-message')) {
        errorSpan.textContent = message;
    } else {
        errorSpan = document.createElement('span');
        errorSpan.classList.add('error-message');
        // FIX IS HERE:
        errorSpan.style.color = getComputedStyle(document.documentElement).getPropertyValue('--error-color');
        // If you know the color is just 'red' or a specific hex, you can use:
        // errorSpan.style.color = 'red'; 
        // errorSpan.style.color = '#FF0000'; 
        errorSpan.style.fontSize = '0.85em';
        errorSpan.style.marginTop = '5px';
        errorSpan.textContent = message;
        element.parentNode.insertBefore(errorSpan, element.nextSibling);
    }
}

        /**
         * Clears validation error for a specific element.
         * @param {HTMLElement} element The element to clear error from.
         */
        function clearValidationError(element) {
            element.classList.remove('error');
            const errorSpan = element.nextElementSibling;
            if (errorSpan && errorSpan.classList.contains('error-message')) {
                errorSpan.remove();
            }
        }

        /**
         * Clears all validation errors from the form.
         */
        function clearAllValidationErrors() {
            document.querySelectorAll('.error').forEach(el => el.classList.remove('error'));
            document.querySelectorAll('.error-message').forEach(el => el.remove());
        }


        // Form submission event listener
        document.getElementById('order-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!validateForm()) {
                Swal.fire({
                    icon: 'error',
                    title: 'Validation Error',
                    text: 'Please fill in all required fields correctly.',
                    customClass: {
                        confirmButton: 'swal-button'
                    }
                });
                return;
            }

            // Prepare order data
            const orderItems = Object.keys(cart).map(productId => {
                const product = products.find(p => p.id === productId);
                return {
                    id: productId,
                    name: product.name,
                    quantity: cart[productId],
                    price: product.price
                };
            });

            const customerDetails = {
                fullName: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                address: document.getElementById('address').value,
                contactNumber: document.getElementById('contactNumber').value,
                orderType: document.getElementById('orderType').value,
                shippingAddress: document.getElementById('shippingAddressSelect').value,
                pickupLocation: document.getElementById('pickupLocation').value,
                deliveryDate: selectedDeliveryDate ? selectedDeliveryDate.toLocaleDateString('en-US') : '',
                deliveryTime: selectedDeliveryTime || '',
                paymentMethod: document.getElementById('paymentMethod').value,
                remarks: document.getElementById('remarks').value,
                deliveryFee: deliveryFee,
                totalAmount: parseFloat(totalAmountDisplay.textContent.replace('‚Ç±', '')) // Get current total from display
            };

            const orderData = {
                customer: customerDetails,
                items: orderItems
            };

            // Show loading spinner
            Swal.fire({
                title: 'Placing Order...',
                html: 'Please wait while we process your order.',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            try {
                const response = await fetch(`${WEB_APP_URL}?action=submitOrder`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData),
                });

                const result = await response.json();

                if (result.status === 'success') {
                    // Show success message with order details
                    let orderSummaryHtml = `
                        <p><strong>Order ID:</strong> ${result.orderId}</p>
                        <p><strong>Total Amount:</strong> ‚Ç±${result.totalAmount.toFixed(2)}</p>
                        <p>We've received your order and will contact you shortly to confirm the details and provide payment instructions.</p>
                        <br>
                        <div class="payment-instructions" style="border-color: var(--secondary-color);">
                            <h4>Payment Instructions for GCASH:</h4>
                            <p><strong>Account Name:</strong> SWEET MARY'S</p>
                            <p><strong>GCASH Number:</strong> 09123456789</p>
                            <p>Please send your payment to the GCASH number above. Once sent, kindly send a screenshot of your transaction to our Facebook page: <a href="https://www.facebook.com/sweetmarys" target="_blank">Sweet Mary's Facebook Page</a></p>
                            <p>Thank you for your order!</p>
                            <img src="https://i.ibb.co/2st849F/gcash.png" alt="GCash QR Code" style="margin-top: 10px;">
                        </div>
                    `;

                    Swal.fire({
                        icon: 'success',
                        title: 'Order Placed Successfully!',
                        html: orderSummaryHtml,
                        confirmButtonText: 'OK',
                        customClass: {
                            confirmButton: 'swal-button'
                        }
                    }).then(() => {
                        clearCart();
                        document.getElementById('order-form').reset(); // Reset form fields
                        selectedDeliveryDate = null; // Clear selected date/time
                        selectedDeliveryTime = null;
                        renderCalendar(); // Reset calendar display
                        renderTimeSlots(); // Clear time slots display
                        toggleOrderType(); // Reset order type display
                        document.getElementById('selectedDateDisplay').textContent = 'Select a Delivery Date';
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Order Failed',
                        text: result.message || 'There was an error placing your order. Please try again.',
                        customClass: {
                            confirmButton: 'swal-button'
                        }
                    });
                }
            } catch (error) {
                console.error('Submission error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Network Error',
                    text: 'Could not connect to the server. Please check your internet connection and try again.',
                    customClass: {
                        confirmButton: 'swal-button'
                    }
                });
            }
        });
    </script>
</body>
</html>
