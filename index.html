<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sweet Mary's Order Form</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
        rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --primary-color: #ff6f61; /* A vibrant, sweet red/orange */
            --secondary-color: #ffc107; /* A warm yellow/gold */
            --accent-color: #4caf50; /* A pleasant green for success/available */
            --text-dark: #333;
            --text-light: #666;
            --bg-light: #f9f9f9;
            --border-color: #ddd;
            --card-bg: #fff;
            --error-color: #f44336;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--bg-light);
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 20px auto;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        .logo-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-section img {
            max-width: 250px;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        h2 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 25px;
            font-size: 2.2em;
            letter-spacing: 1px;
        }

        .section-title {
            font-size: 1.8em;
            color: var(--secondary-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-top: 40px;
            margin-bottom: 25px;
            text-align: center;
        }

        /* --- Tabs for Menu / Order Here --- */
        .main-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .main-tabs button {
            background-color: #eee;
            border: 1px solid var(--border-color);
            padding: 12px 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s ease;
            color: var(--text-dark);
            flex-grow: 1;
            max-width: 200px;
        }

        .main-tabs button:hover {
            background-color: var(--secondary-color);
            color: var(--card-bg);
            border-color: var(--secondary-color);
        }

        .main-tabs button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .tab-content {
            display: none; /* Hidden by default */
        }

        .tab-content.active {
            display: block; /* Shown when active */
        }

        /* --- Menu Gallery --- */
        .menu-gallery {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
        }

        .menu-gallery img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            width: clamp(280px, 45vw, 450px); /* Responsive image size */
        }

        .menu-gallery img:hover {
            transform: translateY(-5px);
        }

        /* --- Category Tabs --- */
        .category-tabs {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            border-top: 1px solid var(--border-color);
        }

        .category-tabs button {
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            padding: 8px 18px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            border-radius: 20px;
            transition: all 0.2s ease;
            color: var(--text-dark);
        }

        .category-tabs button:hover {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .category-tabs button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* --- Product Catalog --- */
        .product-catalog {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .product-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
        }

        .product-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 1px solid var(--border-color);
        }

        .product-info {
            padding: 20px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .product-info h4 {
            font-size: 1.4em;
            margin-bottom: 10px;
            color: var(--primary-color);
            text-align: center;
        }

        .product-info strong {
            display: block;
            margin-top: 10px;
            font-size: 1.1em;
            color: var(--text-dark);
            /* Added for centering */
            text-align: center;
        }

        .product-info p {
            font-size: 1.2em;
            color: var(--accent-color);
            font-weight: 600;
            margin-bottom: 10px;
            /* Added for centering */
            text-align: center;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed var(--border-color);
        }

        .quantity-control button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            font-size: 1.5em;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1; /* Ensures text is centered vertically */
        }

        .quantity-control button:hover {
            background-color: var(--primary-color);
        }

        .quantity-control span {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--text-dark);
            min-width: 30px;
            text-align: center;
        }

        .product-status {
            text-align: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed var(--border-color);
        }

        .status-badge {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
            text-transform: uppercase;
        }

        .status-badge.out-of-stock {
            background-color: #ffebee;
            color: #d32f2f;
            border: 1px solid #d32f2f;
        }

        .status-badge.available {
            background-color: #e8f5e9;
            color: #388e3c;
            border: 1px solid #388e3c;
        }

        .status-badge.coming-soon {
            background-color: #fffde7;
            color: #fbc02d;
            border: 1px solid #fbc02d;
        }

        /* --- Cart Summary --- */
        .cart-summary {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            margin-bottom: 30px;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .cart-summary h3 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.6em;
        }

        #cartItemsList {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
            max-height: 250px; /* Limit height */
            overflow-y: auto; /* Enable scrolling */
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 15px;
        }

        #cartItemsList li {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dotted #eee;
            font-size: 0.95em;
        }

        #cartItemsList li:last-child {
            border-bottom: none;
        }

        .cart-subtotal-item,
        .delivery-fee-item {
            font-weight: 600;
            color: var(--text-dark);
            padding: 10px 0;
            border-top: 1px solid var(--border-color);
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            font-size: 1.1em;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.5em;
            font-weight: 700;
            color: var(--primary-color);
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid var(--secondary-color);
        }

        .proceed-checkout-button {
            display: block;
            width: fit-content; /* Adjust width to content */
            margin: 20px auto 0; /* Center the button */
            padding: 15px 30px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .proceed-checkout-button:hover {
            background-color: #388e3c; /* Darker green */
            transform: translateY(-2px);
        }

        /* --- Form Styling --- */
        form {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 1em;
        }

        .required-star {
            color: var(--primary-color);
            font-size: 1.1em;
            margin-left: 3px;
        }

        .form-group input[type='text'],
        .form-group input[type='email'],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1em;
            color: var(--text-dark);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .form-group input[type='text']:focus,
        .form-group input[type='email']:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 111, 97, 0.2);
            outline: none;
        }

        .form-group input.error,
        .form-group select.error,
        .date-picker-section.error,
        .time-picker-section.error {
            border-color: var(--error-color) !important;
            box-shadow: 0 0 0 3px rgba(244, 67, 54, 0.2) !important;
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: var(--text-light);
            font-size: 0.85em;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* --- Date & Time Picker --- */
        .date-time-picker-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background-color: var(--bg-light);
            display: none; /* Hidden by default, shown for delivery */
        }

        .date-picker-section,
        .time-picker-section {
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .date-input-group {
            position: relative;
            margin-bottom: 15px;
        }

        .date-input-group input {
            padding-right: 40px; /* Space for icon */
        }

        .calendar-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 1.2em;
        }

        .calendar-controls {
            background-color: #fcfcfc;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .calendar-header button {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--secondary-color);
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.2s ease;
        }

        .calendar-header button:hover {
            background-color: #f0f0f0;
        }

        .calendar-header h4 {
            margin: 0;
            font-size: 1.3em;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 10px;
            font-size: 0.85em;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            text-align: center;
        }

        .calendar-days div {
            padding: 10px 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
            font-size: 0.95em;
        }

        .calendar-days div:hover:not(.past-date):not(.other-month) {
            background-color: var(--secondary-color);
            color: white;
        }

        .calendar-days div.past-date {
            color: #ccc;
            cursor: not-allowed;
            background-color: #f5f5f5;
        }

        .calendar-days div.current-day {
            border: 2px solid var(--primary-color);
            font-weight: 700;
        }

        .calendar-days div.selected-date {
            background-color: var(--primary-color);
            color: white;
            font-weight: 700;
        }

        .time-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .time-header h4 {
            font-size: 1.3em;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .time-zone {
            font-size: 0.9em;
            color: var(--text-light);
        }

        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            max-height: 250px;
            overflow-y: auto;
            padding-right: 10px; /* for scrollbar */
        }

        .time-slot {
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            background-color: #fefefe;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            font-weight: 500;
            font-size: 0.95em;
        }

        .time-slot:hover:not(.unavailable) {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .time-slot.unavailable {
            background-color: #f5f5f5;
            color: #ccc;
            border-color: #eee;
            cursor: not-allowed;
            text-decoration: line-through;
        }

        .time-slot.selected-time {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-weight: 700;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        form button[type='button'] {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.3em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 30px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        form button[type='button']:hover {
            background-color: #e55c50; /* Darker red */
            transform: translateY(-2px);
        }

        /* SweetAlert Custom Button Styling */
        .swal-button {
            background-color: var(--primary-color) !important;
            color: white !important;
            border-radius: 5px !important;
            font-size: 1em !important;
            padding: 8px 20px !important;
            transition: background-color 0.2s ease;
        }

        .swal-button:hover {
            background-color: #e55c50 !important;
        }

        /* Payment Instructions in SweetAlert */
        .payment-instructions {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid;
            border-radius: 8px;
            text-align: left;
            font-size: 0.9em;
        }

        .payment-instructions h4 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .payment-instructions p {
            margin-bottom: 5px;
        }

        .payment-instructions img {
            max-width: 180px;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 5px;
        }

        /* Responsive Design */
        @media (min-width: 768px) {
            .container {
                grid-template-columns: 1fr; /* Single column layout for larger screens */
            }

            .date-time-picker-container {
                grid-template-columns: 1fr 1fr; /* Two columns for date and time */
            }
        }

        @media (max-width: 767px) {
            body {
                padding: 15px;
            }

            .container {
                padding: 20px;
            }

            h2 {
                font-size: 1.8em;
            }

            .section-title {
                font-size: 1.5em;
            }

            .product-catalog {
                grid-template-columns: 1fr; /* Single column on small screens */
            }

            .product-info h4 {
                font-size: 1.2em;
            }

            .quantity-control button {
                width: 30px;
                height: 30px;
                font-size: 1.3em;
            }

            .quantity-control span {
                font-size: 1.1em;
            }

            .time-slots {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }

            form button[type='button'] {
                font-size: 1.1em;
                padding: 12px;
            }
        }
        /* For the red asterisk */
        .required-star {
            color: red;
        }
        .form-group {
            margin-bottom: 15px; /* Spacing between form fields */
        }

        .form-group label {
            display: block; /* Make label take its own line */
            margin-bottom: 5px; /* Space between label and input */
            font-weight: bold; /* Make labels stand out */
            color: var(--text-dark); /* Assuming you have a CSS variable for dark text */
        }

        /* Styling for the dropdown itself */
        #shippingAddressSelect {
            width: 100%; /* Take full width of its container */
            padding: 10px 15px; /* Padding inside the dropdown */
            border: 1px solid #ccc; /* Default border color */
            border-radius: 5px; /* Slightly rounded corners */
            font-size: 1em; /* Readable font size */
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
            -webkit-appearance: none; /* Remove default browser dropdown arrow on WebKit browsers */
            -moz-appearance: none; /* Remove default browser dropdown arrow on Mozilla browsers */
            appearance: none; /* Remove default browser dropdown arrow */
            background-color: #fff; /* White background */
            background-image: url('data:image/svg+xml;utf8,<svg fill="#666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>'); /* Custom dropdown arrow */
            background-repeat: no-repeat;
            background-position: right 10px center; /* Position the arrow */
            cursor: pointer;
        }

        /* Red border for error/required state (matching your image) */
        /* This is typically added by JavaScript when a field is invalid */
        #shippingAddressSelect.error,
        #shippingAddressSelect:required:invalid, /* For initial load if required and no selection */
        #shippingAddressSelect:focus { /* Optional: Red border on focus as well, or a different color */
            border-color: #e74c3c; /* Red color */
            box-shadow: 0 0 0 1px #e74c3c; /* Optional: small red glow */
            outline: none; /* Remove default focus outline */
        }

        /* Style for the delivery fee display text */
        #selectedDeliveryFeeDisplay {
            margin-top: 8px; /* Space above the fee text */
            font-size: 0.9em; /* Slightly smaller font than input */
            color: var(--text-light); /* Lighter text color, use CSS variable if defined */
            font-weight: bold; /* Make it bold as in your image */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-section">
            <img src="https://i.postimg.cc/mZXr21dt/mary-logo.png" alt="Sweet Mary's Logo" />
        </div>
        <h2>PLACE YOUR ORDER</h2>

        <div class="main-tabs">
            <button class="tab-button active" onclick="showMainTab('menu')">MENU</button>
            <button class="tab-button" onclick="showMainTab('order')">ORDER HERE</button>
        </div>

        <div id="menuTabContent" class="tab-content active">
            <h3 class="section-title">Our Delicious Menu</h3>
            <div class="menu-gallery">
                <img src="https://i.ibb.co/cc1q6VMS/4.png" alt="Cookies Menu">
                <img src="https://i.ibb.co/ccXK7YcW/6.png" alt="Mini Menu">
                <img src="https://i.ibb.co/rGBLPCk0/3.png" alt="Chocolate Crinkles & Loafs Menu">
                <img src="https://i.ibb.co/rG88CqRk/5.png" alt="Muffin Menu">
            </div>
        </div>

        <div id="orderTabContent" class="tab-content">
            <h3 class="section-title">Select Your Items</h3>
            
            <div class="category-tabs" id="categoryTabs">
            </div>

            <div class="product-catalog" id="productCatalog">
            </div>

            <div class="cart-summary">
                <h3>Your Cart üõí</h3>
                <ul id="cartItemsList">
                </ul>
                <div class="cart-total">
                    <span>Total:</span>
                    <span id="totalAmount">‚Ç±0.00</span>
                </div>
                <button type="button" class="proceed-checkout-button" onclick="proceedToCheckout()">Proceed to Checkout</button>
            </div>

            <form id="orderForm" style="display: none;">
                <h3 class="section-title">Your Details</h3>
                <div class="form-group">
                    <label for="fullName">Full Name <span class="required-star">*</span></label>
                    <input type="text" id="fullName" required />
                </div>
                <div class="form-group">
                    <label for="email">Email Address <span class="required-star">*</span></label>
                    <input
                        type="email"
                        id="email"
                        placeholder="example@gmail.com"
                        required
                    />
                </div>
                <div class="form-group">
                    <label for="address">Address <span class="required-star">*</span></label>
                    <input type="text" id="address" required />
                </div>
                <div class="form-group">
                    <label for="contactNumber">Contact Number <span class="required-star">*</span></label>
                    <input
                        type="text"
                        id="contactNumber"
                        maxlength="11"
                        placeholder="11-digits number"
                        required
                    />
                </div>

                <h3 class="section-title">Order Type</h3>
                <div class="form-group">
                    <label for="orderType">Choose how to get your order: <span class="required-star">*</span></label>
                    <select id="orderType" required onchange="toggleOrderType()">
                        <option value="">SELECT</option>
                        <option value="delivery">Delivery</option>
                        <option value="pickup">Pickup</option>
                        <option value="meetup">Meet Up</option>
                    </select>
                </div>

                <div id="deliveryDetails" class="form-group" style="display: none;">
                    <label for="shippingAddressSelect">Delivery Address <span class="required-star">*</span></label>
                    <select id="shippingAddressSelect" required onchange="handleDeliveryLocationChange()">
                        <option value="">Select a delivery location</option>
                    </select>
                    <div id="selectedDeliveryFeeDisplay" class="info-text"></div>
                </div>

                <div id="pickupDetails" class="form-group" style="display: none;">
                    <label for="pickupLocation">Pickup Location</label>
                    <input type="text" id="pickupLocation" value="1435 ARANVILLE SUBD BRGY SAN JOSE SAN PABLO CITY LAGUNA" readonly />
                    <small>Please pick up your order at our designated location.</small>
                </div>

                <h3 class="section-title" id="deliveryDateTimeHeader" style="margin-top: 40px; display: none;">Delivery Date & Time</h3>
                <div class="date-time-picker-container" style="display: none;">
                    <div class="date-picker-section">
                        <label for="deliveryDate">Delivery Date <span class="required-star">*</span></label>
                        <div class="date-input-group">
                            <input type="text" id="deliveryDate" placeholder="MM/DD/YYYY" readonly required />
                            <span class="calendar-icon" onclick="document.getElementById('deliveryDate').click()">üóìÔ∏è</span>
                        </div>
                        <div class="calendar-controls">
                            <div class="calendar-header">
                                <button type="button" onclick="changeMonth(-1)">&lt;</button>
                                <h4 id="monthYear"></h4>
                                <button type="button" onclick="changeMonth(1)">&gt;</button>
                            </div>
                            <div class="calendar-weekdays">
                                <div>SUN</div>
                                <div>MON</div>
                                <div>TUE</div>
                                <div>WED</div>
                                <div>THU</div>
                                <div>FRI</div>
                                <div>SAT</div>
                            </div>
                            <div class="calendar-days" id="calendarDays">
                            </div>
                        </div>
                    </div>

                    <div class="time-picker-section">
                        <label for="deliveryTime">Delivery Time <span class="required-star">*</span></label>
                        <div class="time-header">
                            <h4 id="selectedDateDisplay">Select a Delivery Date</h4>
                            <span class="time-zone" id="currentTimeZone"></span>
                        </div>
                        <div class="time-slots" id="timeSlots">
                        </div>
                    </div>
                </div>
                <button type="button" onclick="submitOrder()">Place Order</button>
            </form>
        </div>
    </div>

    <script>
        // --- Configuration ---
        // IMPORTANT: Replace with your deployed Google Apps Script Web App URL
        const APPS_SCRIPT_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxir-g0G1Uok-19l1v1JjEofw35X5n4Y2hMVnesSJl7nDNmO4Z42IyDLXVNFWKb2t2y/exec'; 

        // Global variables for product and delivery data
        let productData = [];
        let deliveryLocations = [];
        let cart = {}; // Stores {productId: quantity}
        let currentTotal = 0;
        let selectedDeliveryFee = 0;
        let currentMonth, currentYear, selectedDate = null;
        const today = new Date();

        // --- Initial Data Fetch on Page Load ---
        document.addEventListener('DOMContentLoaded', () => {
            fetchProductsAndDeliveryLocations();
            updateCartSummary(); // Initialize cart summary
            renderCalendar(); // Initialize calendar
        });

        async function fetchProductsAndDeliveryLocations() {
            try {
                const response = await fetch(APPS_SCRIPT_WEB_APP_URL, {
                    method: 'POST', // Use POST to request data based on action
                    mode: 'cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'fetchInitialData' }) // Request products and locations
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log("Fetched data:", data);

                if (data.status === 'success') {
                    productData = data.products || [];
                    deliveryLocations = data.deliveryLocations || [];
                    renderCategories();
                    renderProducts('All'); // Render all products initially
                    populateDeliveryLocations();
                } else {
                    Swal.fire('Error', 'Failed to load product and delivery data: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error fetching initial data:', error);
                Swal.fire('Error', 'Could not connect to the server to load data. Please try again later.', 'error');
            }
        }

        // --- Main Tab Switching (Menu / Order Here) ---
        function showMainTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            document.getElementById(tabId + 'TabContent').classList.add('active');
            document.querySelector(`.tab-button[onclick="showMainTab('${tabId}')"]`).classList.add('active');
        }

        // --- Product Categories and Rendering ---
        function renderCategories() {
            const categoryTabsDiv = document.getElementById('categoryTabs');
            categoryTabsDiv.innerHTML = ''; // Clear existing
            
            // Add 'All' category button
            const allBtn = document.createElement('button');
            allBtn.textContent = 'All';
            allBtn.classList.add('active'); // 'All' is active by default
            allBtn.onclick = () => renderProducts('All');
            categoryTabsDiv.appendChild(allBtn);

            const categories = [...new Set(productData.map(p => p.category))];
            categories.forEach(category => {
                const button = document.createElement('button');
                button.textContent = category;
                button.onclick = () => renderProducts(category);
                categoryTabsDiv.appendChild(button);
            });
        }

        function renderProducts(category) {
            const productCatalogDiv = document.getElementById('productCatalog');
            productCatalogDiv.innerHTML = ''; // Clear existing products

            // Update active category button
            document.querySelectorAll('.category-tabs button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === category) {
                    btn.classList.add('active');
                }
            });

            const filteredProducts = category === 'All' ? productData : productData.filter(p => p.category === category);

            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.classList.add('product-card');
                productCard.dataset.productId = product.id; // Store product ID

                const statusClass = product.stock > 0 ? 'available' : 'out-of-stock';
                const statusText = product.stock > 0 ? 'Available' : 'Out of Stock';
                const isAvailable = product.stock > 0;

                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="product-img" />
                    <div class="product-info">
                        <h4>${product.name}</h4>
                        <strong>${product.description}</strong>
                        <p>‚Ç±${product.price.toFixed(2)}</p>
                        <div class="quantity-control">
                            <button type="button" onclick="changeQuantity('${product.id}', -1)" ${!isAvailable ? 'disabled' : ''}>-</button>
                            <span id="qty-${product.id}">${cart[product.id] || 0}</span>
                            <button type="button" onclick="changeQuantity('${product.id}', 1)" ${!isAvailable ? 'disabled' : ''}>+</button>
                        </div>
                        <div class="product-status">
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                    </div>
                `;
                productCatalogDiv.appendChild(productCard);
            });
        }

        function changeQuantity(productId, delta) {
            const product = productData.find(p => p.id === productId);
            if (!product) return;

            let currentQty = cart[productId] || 0;
            let newQty = currentQty + delta;

            if (newQty < 0) newQty = 0;
            if (newQty > product.stock && product.stock !== -1) { // -1 implies unlimited
                newQty = product.stock;
                Swal.fire('Oops!', `Only ${product.stock} of ${product.name} left in stock!`, 'warning');
            }

            cart[productId] = newQty;

            // Update quantity display on product card
            const qtySpan = document.getElementById(`qty-${productId}`);
            if (qtySpan) {
                qtySpan.textContent = newQty;
            }
            
            updateCartSummary();
        }

        function updateCartSummary() {
            const cartItemsList = document.getElementById('cartItemsList');
            const totalAmountSpan = document.getElementById('totalAmount');
            cartItemsList.innerHTML = ''; // Clear previous items
            let subtotal = 0;

            for (const productId in cart) {
                const quantity = cart[productId];
                if (quantity > 0) {
                    const product = productData.find(p => p.id === productId);
                    if (product) {
                        const itemTotal = product.price * quantity;
                        subtotal += itemTotal;

                        const li = document.createElement('li');
                        li.innerHTML = `
                            <span>${product.name} x ${quantity}</span>
                            <span>‚Ç±${itemTotal.toFixed(2)}</span>
                        `;
                        cartItemsList.appendChild(li);
                    }
                }
            }

            // Add subtotal
            const subtotalLi = document.createElement('li');
            subtotalLi.classList.add('cart-subtotal-item');
            subtotalLi.innerHTML = `<span>Subtotal:</span><span>‚Ç±${subtotal.toFixed(2)}</span>`;
            cartItemsList.appendChild(subtotalLi);

            // Add delivery fee if applicable
            if (selectedDeliveryFee > 0 && document.getElementById('orderType').value === 'delivery') {
                const deliveryFeeLi = document.createElement('li');
                deliveryFeeLi.classList.add('delivery-fee-item');
                deliveryFeeLi.innerHTML = `<span>Delivery Fee:</span><span>‚Ç±${selectedDeliveryFee.toFixed(2)}</span>`;
                cartItemsList.appendChild(deliveryFeeLi);
            }

            currentTotal = subtotal + selectedDeliveryFee;
            totalAmountSpan.textContent = `‚Ç±${currentTotal.toFixed(2)}`;
        }

        function proceedToCheckout() {
            const selectedItems = Object.keys(cart).filter(productId => cart[productId] > 0);

            if (selectedItems.length === 0) {
                Swal.fire('Oops!', 'Your cart is empty. Please add items before proceeding to checkout.', 'warning');
                return;
            }

            document.getElementById('orderForm').style.display = 'block';
            document.getElementById('orderTabContent').scrollIntoView({ behavior: 'smooth' });
        }

        // --- Order Type Logic (Delivery/Pickup/Meet Up) ---
        function toggleOrderType() {
            const orderType = document.getElementById('orderType').value;
            const deliveryDetails = document.getElementById('deliveryDetails');
            const pickupDetails = document.getElementById('pickupDetails');
            const deliveryDateTimeHeader = document.getElementById('deliveryDateTimeHeader');
            const dateTimePickerContainer = document.querySelector('.date-time-picker-container');
            
            // Reset delivery fee and date/time selections
            selectedDeliveryFee = 0;
            selectedDate = null;
            document.getElementById('deliveryDate').value = '';
            document.getElementById('selectedDateDisplay').textContent = 'Select a Delivery Date';
            document.getElementById('shippingAddressSelect').value = '';
            document.getElementById('selectedDeliveryFeeDisplay').textContent = '';
            renderTimeSlots(); // Clear time slots

            deliveryDetails.style.display = 'none';
            pickupDetails.style.display = 'none';
            deliveryDateTimeHeader.style.display = 'none';
            dateTimePickerContainer.style.display = 'none';

            // Remove error class from date/time containers if they were hidden
            document.querySelector('.date-picker-section').classList.remove('error');
            document.querySelector('.time-picker-section').classList.remove('error');

            // Reset required attributes for delivery specific fields
            document.getElementById('shippingAddressSelect').removeAttribute('required');
            document.getElementById('deliveryDate').removeAttribute('required');

            if (orderType === 'delivery') {
                deliveryDetails.style.display = 'block';
                deliveryDateTimeHeader.style.display = 'block';
                dateTimePickerContainer.style.display = 'grid';
                document.getElementById('shippingAddressSelect').setAttribute('required', 'required');
                document.getElementById('deliveryDate').setAttribute('required', 'required');
            } else if (orderType === 'pickup') {
                pickupDetails.style.display = 'block';
                deliveryDateTimeHeader.style.display = 'block';
                dateTimePickerContainer.style.display = 'grid'; // Pickup also needs date/time
                document.getElementById('deliveryDate').setAttribute('required', 'required');
            } else if (orderType === 'meetup') {
                // Meetup will also need date/time
                deliveryDateTimeHeader.style.display = 'block';
                dateTimePickerContainer.style.display = 'grid';
                document.getElementById('deliveryDate').setAttribute('required', 'required');
            }

            updateCartSummary(); // Recalculate total as delivery fee might change
        }

        function populateDeliveryLocations() {
            const select = document.getElementById('shippingAddressSelect');
            select.innerHTML = '<option value="">Select a delivery location</option>'; // Keep default
            deliveryLocations.forEach(location => {
                const option = document.createElement('option');
                option.value = location.barangay;
                option.textContent = `${location.barangay} (‚Ç±${location.fee.toFixed(2)})`;
                option.dataset.fee = location.fee; // Store fee in dataset
                select.appendChild(option);
            });
        }

        function handleDeliveryLocationChange() {
            const select = document.getElementById('shippingAddressSelect');
            const selectedOption = select.options[select.selectedIndex];
            const deliveryFeeDisplay = document.getElementById('selectedDeliveryFeeDisplay');

            if (selectedOption && selectedOption.value) {
                selectedDeliveryFee = parseFloat(selectedOption.dataset.fee);
                deliveryFeeDisplay.textContent = `Delivery Fee: ‚Ç±${selectedDeliveryFee.toFixed(2)}`;
            } else {
                selectedDeliveryFee = 0;
                deliveryFeeDisplay.textContent = '';
            }
            updateCartSummary();
        }

        // --- Date Picker Logic ---
        function renderCalendar() {
            const now = new Date();
            currentMonth = currentMonth || now.getMonth();
            currentYear = currentYear || now.getFullYear();

            const monthYearDisplay = document.getElementById('monthYear');
            monthYearDisplay.textContent = new Date(currentYear, currentMonth).toLocaleString('en-US', { month: 'long', year: 'numeric' });

            const calendarDaysDiv = document.getElementById('calendarDays');
            calendarDaysDiv.innerHTML = '';

            const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const daysInPrevMonth = new Date(currentYear, currentMonth, 0).getDate();

            // Fill leading empty days from previous month
            for (let i = firstDayOfMonth; i > 0; i--) {
                const dayDiv = document.createElement('div');
                dayDiv.classList.add('past-date', 'other-month'); // Add other-month to distinguish
                dayDiv.textContent = daysInPrevMonth - i + 1;
                calendarDaysDiv.appendChild(dayDiv);
            }

            // Fill days of the current month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.textContent = day;
                const currentDate = new Date(currentYear, currentMonth, day);
                currentDate.setHours(0, 0, 0, 0); // Normalize to start of day for comparison
                today.setHours(0, 0, 0, 0);

                if (currentDate < today) {
                    dayDiv.classList.add('past-date');
                    dayDiv.onclick = null; // Disable clicking past dates
                } else {
                    dayDiv.onclick = () => selectDate(currentDate);
                    if (selectedDate && currentDate.getTime() === selectedDate.getTime()) {
                        dayDiv.classList.add('selected-date');
                    }
                    if (currentDate.getTime() === today.getTime()) {
                        dayDiv.classList.add('current-day');
                    }
                }
                calendarDaysDiv.appendChild(dayDiv);
            }
            renderTimeSlots(); // Re-render time slots when calendar changes
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        }

        function selectDate(date) {
            selectedDate = date;
            const deliveryDateInput = document.getElementById('deliveryDate');
            deliveryDateInput.value = `${date.getMonth() + 1}/${date.getDate()}/${date.getFullYear()}`;
            
            document.querySelectorAll('.calendar-days div').forEach(dayDiv => {
                dayDiv.classList.remove('selected-date');
            });
            event.target.classList.add('selected-date'); // Add to the clicked div

            document.getElementById('selectedDateDisplay').textContent = deliveryDateInput.value;
            renderTimeSlots(); // Render time slots for the newly selected date
            document.querySelector('.date-picker-section').classList.remove('error'); // Clear error
        }

        // --- Time Picker Logic ---
        function renderTimeSlots() {
            const timeSlotsDiv = document.getElementById('timeSlots');
            timeSlotsDiv.innerHTML = '';
            
            if (!selectedDate) {
                timeSlotsDiv.innerHTML = '<div style="text-align:center; padding: 20px; color: var(--text-light);">Please select a delivery date first.</div>';
                return;
            }

            const currentDateTime = new Date();
            const timeZoneSpan = document.getElementById('currentTimeZone');
            timeZoneSpan.textContent = `(Philippine Time)`; // Hardcoded for now

            // Example time slots - you can customize these
            const slots = [
                '9:00 AM - 10:00 AM', '10:00 AM - 11:00 AM', '11:00 AM - 12:00 PM',
                '1:00 PM - 2:00 PM', '2:00 PM - 3:00 PM', '3:00 PM - 4:00 PM',
                '4:00 PM - 5:00 PM', '5:00 PM - 6:00 PM'
            ];

            const selectedDateString = selectedDate.toDateString();

            slots.forEach(slot => {
                const slotDiv = document.createElement('div');
                slotDiv.classList.add('time-slot');
                slotDiv.textContent = slot;
                slotDiv.dataset.time = slot; // Store the time string

                const [startTimeStr] = slot.split(' - ');
                // Create a Date object for the start time of the slot on the selected date
                const [time, ampm] = startTimeStr.split(' ');
                let [hours, minutes] = time.split(':').map(Number);
                if (ampm === 'PM' && hours !== 12) hours += 12;
                if (ampm === 'AM' && hours === 12) hours = 0; // Midnight 12 AM

                const slotDateTime = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), selectedDate.getDate(), hours, minutes, 0);

                if (slotDateTime <= currentDateTime && selectedDateString === today.toDateString()) {
                    slotDiv.classList.add('unavailable');
                    slotDiv.onclick = null;
                } else {
                    slotDiv.onclick = () => selectTime(slotDiv);
                }
                timeSlotsDiv.appendChild(slotDiv);
            });
        }

        function selectTime(selectedSlotDiv) {
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected-time');
            });
            selectedSlotDiv.classList.add('selected-time');
            document.getElementById('deliveryTime').value = selectedSlotDiv.dataset.time; // Update hidden input if needed or just use dataset
            document.querySelector('.time-picker-section').classList.remove('error'); // Clear error
        }

        // --- Form Validation ---
        function validateForm() {
            let isValid = true;

            const requiredFields = [
                'fullName', 'email', 'address', 'contactNumber', 'orderType'
            ];

            requiredFields.forEach(fieldId => {
                const input = document.getElementById(fieldId);
                if (input) {
                    if (input.value.trim() === '') {
                        input.classList.add('error');
                        isValid = false;
                    } else {
                        input.classList.remove('error');
                    }
                }
            });

            // Specific validation for email format
            const emailInput = document.getElementById('email');
            if (emailInput && !/\S+@\S+\.\S+/.test(emailInput.value)) {
                emailInput.classList.add('error');
                isValid = false;
            }

            // Specific validation for contact number (11 digits, numeric)
            const contactNumberInput = document.getElementById('contactNumber');
            if (contactNumberInput && !/^\d{11}$/.test(contactNumberInput.value)) {
                contactNumberInput.classList.add('error');
                isValid = false;
            }

            const orderType = document.getElementById('orderType').value;
            const deliveryDateInput = document.getElementById('deliveryDate');
            const deliveryTimeSelected = document.querySelector('.time-slot.selected-time');
            const shippingAddressSelect = document.getElementById('shippingAddressSelect');
            const datePickerSection = document.querySelector('.date-picker-section');
            const timePickerSection = document.querySelector('.time-picker-section');

            if (orderType === 'delivery' || orderType === 'pickup' || orderType === 'meetup') {
                if (deliveryDateInput.value.trim() === '') {
                    deliveryDateInput.classList.add('error');
                    datePickerSection.classList.add('error');
                    isValid = false;
                } else {
                    deliveryDateInput.classList.remove('error');
                    datePickerSection.classList.remove('error');
                }

                if (!deliveryTimeSelected) {
                    timePickerSection.classList.add('error');
                    isValid = false;
                } else {
                    timePickerSection.classList.remove('error');
                }
            }

            if (orderType === 'delivery') {
                if (shippingAddressSelect.value.trim() === '') {
                    shippingAddressSelect.classList.add('error');
                    isValid = false;
                } else {
                    shippingAddressSelect.classList.remove('error');
                }
            }
            
            return isValid;
        }

        // --- Form Submission ---
        async function submitOrder() {
            if (!validateForm()) {
                Swal.fire('Validation Error', 'Please fill in all required fields and correct any errors.', 'error');
                return;
            }

            const customerName = document.getElementById('fullName').value;
            const customerEmail = document.getElementById('email').value;
            const customerAddress = document.getElementById('address').value;
            const customerContact = document.getElementById('contactNumber').value;
            const orderType = document.getElementById('orderType').value;
            const deliveryDate = document.getElementById('deliveryDate').value;
            const deliveryTime = document.querySelector('.time-slot.selected-time')?.dataset.time || '';
            const shippingAddress = document.getElementById('shippingAddressSelect').value;
            const pickupLocation = document.getElementById('pickupLocation').value;

            const orderItems = [];
            for (const productId in cart) {
                const quantity = cart[productId];
                if (quantity > 0) {
                    const product = productData.find(p => p.id === productId);
                    if (product) {
                        orderItems.push({
                            id: productId,
                            name: product.name,
                            quantity: quantity,
                            price: product.price,
                            total: (product.price * quantity).toFixed(2)
                        });
                    }
                }
            }

            const payload = {
                action: 'submitOrder',
                customer: {
                    name: customerName,
                    email: customerEmail,
                    address: customerAddress,
                    contact: customerContact
                },
                order: {
                    type: orderType,
                    items: orderItems,
                    subtotal: (currentTotal - selectedDeliveryFee).toFixed(2),
                    deliveryFee: selectedDeliveryFee.toFixed(2),
                    totalAmount: currentTotal.toFixed(2),
                    deliveryDate: deliveryDate,
                    deliveryTime: deliveryTime,
                    shippingAddress: (orderType === 'delivery' ? shippingAddress : (orderType === 'pickup' ? pickupLocation : customerAddress)), // Use appropriate address
                    deliveryLocationName: (orderType === 'delivery' ? document.getElementById('shippingAddressSelect').options[document.getElementById('shippingAddressSelect').selectedIndex].textContent.split('(')[0].trim() : '')
                }
            };

            Swal.fire({
                title: 'Submitting Order...',
                html: 'Please wait while we process your order.',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            try {
                const response = await fetch(APPS_SCRIPT_WEB_APP_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('Apps Script Response:', result);

                if (result.status === 'success') {
                    Swal.fire({
                        title: 'Order Placed Successfully!',
                        html: `
                            <p>Thank you for your order, <strong>${customerName}</strong>! Your Order ID is <strong>${result.orderId}</strong>.</p>
                            <div class="payment-instructions" style="border-color: var(--primary-color);">
                                <h4>Payment Instructions (GCash)</h4>
                                <p>Please send your payment to the following GCash account:</p>
                                <p><strong>GCash Name:</strong> ${result.gcashName}</p>
                                <p><strong>GCash Number:</strong> ${result.gcashNumber}</p>
                                <p><strong>Total Amount Due:</strong> ‚Ç±${currentTotal.toFixed(2)}</p>
                                <img src="${result.gcashQRUrl}" alt="GCash QR Code" style="margin-top: 10px;">
                                <p style="margin-top: 15px;">A confirmation email with your order details and payment instructions has been sent to <strong>${customerEmail}</strong>.</p>
                                <p>Please send a screenshot of your payment to our Facebook page: <a href="https://facebook.com/sweetmarys" target="_blank">Sweet Mary's Facebook</a></p>
                            </div>
                        `,
                        icon: 'success',
                        confirmButtonText: 'Great!',
                        customClass: {
                            confirmButton: 'swal-button'
                        }
                    }).then(() => {
                        resetFormAndCart();
                    });
                } else {
                    Swal.fire('Order Failed', 'There was an issue placing your order: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Error submitting order:', error);
                Swal.fire('Submission Error', 'Could not submit your order. Please check your internet connection and try again.', 'error');
            }
        }

        function resetFormAndCart() {
            cart = {};
            currentTotal = 0;
            selectedDeliveryFee = 0;
            selectedDate = null;
            document.getElementById('orderForm').reset(); // Resets all form fields
            document.getElementById('orderForm').style.display = 'none';
            document.getElementById('deliveryDetails').style.display = 'none';
            document.getElementById('pickupDetails').style.display = 'none';
            document.getElementById('deliveryDateTimeHeader').style.display = 'none';
            document.querySelector('.date-time-picker-container').style.display = 'none';
            document.getElementById('selectedDeliveryFeeDisplay').textContent = '';
            document.getElementById('deliveryDate').value = '';
            document.getElementById('selectedDateDisplay').textContent = 'Select a Delivery Date';
            renderTimeSlots(); // Clear time slots
            updateCartSummary();
            renderProducts(document.querySelector('.category-tabs button.active')?.textContent || 'All'); // Re-render products to reset quantities
        }
    </script>
</body>
</html>
